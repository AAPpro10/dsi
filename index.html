<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test DSI: PDF Completo + Estad칤sticas</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --success: #16a34a;
            --error: #dc2626;
            --warning: #f59e0b;
            --bg: #f3f4f6;
            --card: #ffffff;
            --text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: var(--card);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            display: flex;
            flex-direction: column;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #6b7280;
            font-size: 1rem;
        }

        /* Menu de Configuraci칩n */
        .config-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .config-btn {
            padding: 1.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .config-btn:hover:not(.disabled) {
            border-color: var(--primary);
            background-color: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
        }

        .config-btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #f3f4f6;
            border-color: #e5e7eb;
        }

        .config-btn h3 {
            margin: 0 0 5px 0;
            color: var(--primary);
        }

        .config-btn p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .icon {
            font-size: 2rem;
            background: #eff6ff;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: var(--primary);
            flex-shrink: 0;
        }

        /* Quiz Styles */
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            font-weight: 600;
            color: #6b7280;
            background: #f8fafc;
            padding: 10px;
            border-radius: 8px;
        }

        .question-text {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background-color: #eff6ff;
        }

        .option-btn.correct {
            background-color: #dcfce7;
            border-color: var(--success);
            color: #14532d;
        }

        .option-btn.incorrect {
            background-color: #fee2e2;
            border-color: var(--error);
            color: #7f1d1d;
        }

        .feedback {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 8px;
            background-color: #f8fafc;
            border-left: 4px solid var(--primary);
            display: none;
            animation: fadeIn 0.3s;
        }

        .controls {
            margin-top: 2rem;
            display: flex;
            justify-content: space-between;
        }

        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background-color: var(--secondary);
        }

        .btn.secondary {
            background-color: #6b7280;
        }

        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }

        /* Results Screen */
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            margin: 0 auto 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Stats & History Styles */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .history-item:hover {
            background: #eff6ff;
            border-color: var(--primary);
        }

        .history-score {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .score-good { color: var(--success); }
        .score-bad { color: var(--error); }
        .score-mid { color: var(--warning); }

        .review-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .review-card.is-incorrect {
            border-left: 4px solid var(--error);
        }

        .review-card.is-correct {
            border-left: 4px solid var(--success);
        }

        .review-q {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .review-ans {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        .badge-fail { background: #fee2e2; color: #991b1b; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Test DSI (PDF)</h1>
        <div class="subtitle">Banco de preguntas + Estad칤sticas</div>
    </header>

    <div id="config-screen">
        <p style="text-align: center; margin-bottom: 20px; font-size: 1.1rem;">Selecciona el modo de examen:</p>
        
        <div class="config-section">
            <div class="config-btn" onclick="startQuiz('ordered')">
                <div class="icon">游닇</div>
                <div>
                    <h3>Orden Est치ndar</h3>
                    <p>Preguntas en orden original (1 a 54).</p>
                </div>
            </div>

            <div class="config-btn" onclick="startQuiz('shuffle_q')">
                <div class="icon">游</div>
                <div>
                    <h3>Preguntas Aleatorias</h3>
                    <p>Orden aleatorio. Respuestas fijas (a, b, c).</p>
                </div>
            </div>

            <div class="config-btn" onclick="startQuiz('shuffle_all')">
                <div class="icon">游</div>
                <div>
                    <h3>Modo Dif칤cil (Todo Aleatorio)</h3>
                    <p>Preguntas y respuestas mezcladas.</p>
                </div>
            </div>

            <div id="btn-failed-mode" class="config-btn" onclick="startQuiz('review_failed')">
                <div class="icon" style="background-color: #fee2e2; color: #dc2626;">丘멆잺</div>
                <div>
                    <h3>Repasar Fallos <span id="failed-count-badge" class="badge badge-fail">0</span></h3>
                    <p>Solo preguntas que has fallado anteriormente. Si aciertas, desaparecen.</p>
                </div>
            </div>

            <div class="config-btn" onclick="showStatsScreen()">
                <div class="icon" style="background-color: #f3f4f6; color: #4b5563;">游늵</div>
                <div>
                    <h3>Estad칤sticas e Historial</h3>
                    <p>Revisa tus notas y examina tus errores pasados.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="quiz-screen" style="display: none;">
        <div class="stats">
            <span id="progress-text">Pregunta 1 de X</span>
            <span id="score-text">Aciertos: 0</span>
        </div>

        <div id="question-container">
            </div>

        <div class="feedback" id="feedback"></div>

        <div class="controls">
            <button class="btn secondary" onclick="confirmExit()">Salir</button>
            <button id="next-btn" class="btn" onclick="nextQuestion()" disabled>Siguiente</button>
        </div>
    </div>

    <div id="result-screen" style="display: none; text-align: center;">
        <h2>춰Examen Finalizado!</h2>
        <div class="score-circle" id="final-score">0%</div>
        <p id="final-msg" style="font-size: 1.2rem; margin-bottom: 2rem;"></p>
        
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button class="btn" onclick="goToMenu()">Volver al Inicio</button>
            <button class="btn secondary" onclick="showStatsScreen()">Ver Estad칤sticas</button>
        </div>
    </div>

    <div id="stats-screen" style="display: none;">
        <h2 style="text-align: center; margin-bottom: 20px;">Historial de Ex치menes</h2>
        <div id="history-container" class="history-list">
            <p style="text-align: center; color: #666;">No hay ex치menes registrados a칰n.</p>
        </div>
        <div class="controls" style="justify-content: center;">
            <button class="btn" onclick="goToMenu()">Volver</button>
        </div>
    </div>

    <div id="review-screen" style="display: none;">
        <h2 style="text-align: center; margin-bottom: 10px;">Revisi칩n de Examen</h2>
        <p id="review-meta" style="text-align: center; margin-bottom: 20px; color: #666;"></p>
        
        <div id="review-container" class="history-list">
            </div>

        <div class="controls" style="justify-content: center;">
            <button class="btn" onclick="showStatsScreen()">Volver al Historial</button>
        </div>
    </div>
</div>

<script>
    // --- DATOS DEL PDF (Transcripci칩n Exacta) ---
    // NOTA: 'a' es el 칤ndice de la respuesta correcta (0=a, 1=b, 2=c).
    // NOTA: 'id' es el 칤ndice original en el array para tracking de fallos.
    const rawPdfData = [
        { q: "1. El prototipado es una actividad de dise침o clave para transformar ...", a: 0, opts: ["...las suposiciones y requerimientos en una soluci칩n de dise침o software.", "...las suposiciones y requerimientos en varias soluciones de dise침o software.", "ninguna es correcta"] },
        { q: "2. Indica la respuesta correcta:", a: 2, opts: ["Todas las necesidades del usuario deben representarse en un diagrama de flujo de carril", "Un diagrama de flujo es la representaci칩n visual de una serie de tareas o pasos de una tarea", "Los diagramas de dependencias y de carril son los m칠todos m치s comunes para mostrar un flujo de tareas"] },
        { q: "3. 쮺u치l de estas afirmaciones NO es correcta acerca de un Wireframe?", a: 1, opts: ["Tiene un estilo narrativo digital.", "Son dise침os con un alto nivel de detalle", "Normalmente se crea en el comienzo del proceso de dise침o"] },
        { q: "4. Indica qu칠 no se tiene en consideraci칩n en el dise침o visual", a: 1, opts: ["Tipograf칤a.", "Interacci칩n y patrones.", "Branding"] },
        { q: "5. El proceso de recogida de requisitos del software", a: 0, opts: ["se produce en paralelo y es incompleto.", "se produce en paralelo y es completo.", "se produce en pila, es decir hasta que no acaba una tarea no se empieza con la siguiente."] },
        { q: "6. 쮺u치l de estas directrices es una directriz para evitar problemas de usabilidad de tipo direccional?", a: 0, opts: ["Ley de Fitt", "Sensibilidad Internacional", "Accesibilidad Universal"] },
        { q: "7. 쯈ui칠n son los destinatarios de un Storyboard?", a: 1, opts: ["Los altos directivos de la empresa.", "Los miembros del equipo de dise침o interno.", "Los clientes y usuarios finales."] },
        { q: "8. Sobre el prototipado:", a: 0, opts: ["Su prop칩sito es la de obtener retroalimentaci칩n directa con el usuario final.", "Existen prototipos de alta, baja calidad y horizontal/vertical en direccionalidad.", "Un prototipo de baja calidad no sirve para conceptualizar el dise침o de las p치ginas como posiciones, 치reas, banners,..."] },
        { q: "9. Indica la respuesta incorrecta de los Escenarios de Uso:", a: 0, opts: ["Se realizan en la fase de verificaci칩n de requisitos.", "Describen atributos espec칤ficos acerca de los usuarios, sus acciones, el entorno, las tareas diarias y las actividades.", "Ayudan a definir con claridad el contexto del uso de un requisito"] },
        { q: "10. 쮻e estas opciones cual no es una t칠cnica de revelaci칩n?", a: 0, opts: ["Textos expandibles", "Men칰s de comandos", "Ventanas secundarias"] },
        { q: "11. Desde la perspectiva del dise침o y prototipado, los requisitos se pueden dividir en cuatro categor칤as principales:", a: 2, opts: ["exploratorios, validaci칩n, negocios/ marketing y funcionales.", "negocios/ marketing, funcionales y validaci칩n.", "negocios/marketing, funcionales, t칠cnicos y de usabilidad."] },
        { q: "12. Sobre el branding:", a: 0, opts: ["El logo, los colores, el eslogan y las gu칤as de estilo si pertenecen al branding", "El branding no fideliza a los seguidores de la marca.", "El logo, los colores, el eslogan y las gu칤as de estilo no pertenecen al branding"] },
        { q: "13. Las suposiciones son esenciales para", a: 0, opts: ["el proceso de prototipado.", "el proceso de validaci칩n.", "el proceso de evaluaci칩n."] },
        { q: "14. 쮺u치l de estas respuestas no es una directriz del dise침o?", a: 0, opts: ["Ritmo y Movimiento", "Agrupaci칩n l칩gica", "Balance"] },
        { q: "15. 쮺u치les de las siguientes caracter칤sticas se reflejan en un diagrama de Carril?", a: 1, opts: ["Finalidad y Contenido", "Tareas y roles", "Requisitos funcionales"] },
        { q: "16. En el modelo \"Mago de Oz\", es cierto que", a: 2, opts: ["Se puede usar en cualquier etapa de dise침o", "El miembro del equipo de dise침o debe acompa침ar al participante", "Simula las respuestas del sistema"] },
        { q: "17. En el dise침o de la informaci칩n, las t칠cnicas de ajuste de la fidelidad son...", a: 0, opts: ["Card Sorting, Prototipado Wireframe, Prototipado de alta fidelidad.", "Card Sorting, Prototipado de alta fidelidad, Prototipado de baja fidelidad.", "Card Sorting, Prototipado Wireframe, Prototipado de baja fidelidad."] },
        { q: "18. 쯃os usuarios deben tener el control?", a: 1, opts: ["Si, pero el sistema tendr치 la decisi칩n final en una situaci칩n cr칤tica", "Si, y deben sentir que controlan su interacci칩n con el software", "Ninguna de las anteriores es correcta."] },
        { q: "19. Un prototipo sobredimensionado artificialmente es aquel en que...", a: 2, opts: ["Conduce a tomar decisiones correctas en la fase de requisitos", "Todas las anteriores respuestas son correctas.", "Es aquel que conduce a tomar decisiones prematuras mostrando una alta fidelidad no apropiada"] },
        { q: "20. El m칠todo Card Sorting", a: 2, opts: ["Es un m칠todo abstracto, interactivo, participativo que se puede llevar a cabo tanto en las primeras etapas del proceso de software como en las finales.", "Es un m칠todo abstracto, interactivo, participativo llevado a cabo en las 칰ltimas etapas del proceso de software", "Es un m칠todo abstracto, interactivo, participativo llevado a cabo en las primeras etapas del proceso de software."] },
        { q: "21. Los pasos para la creaci칩n de un flujo de tareas con un mapa de capas de tareas son los siguientes:", a: 2, opts: ["Identificar dependencias - Eliminar dependencias redundantes - Crear lista de tareas y mostrar los elementos de la capa de tarea", "Crear una lista de tareas - Mostrar los elementos de la capa de tareas - Identificar dependencias y eliminar dependencias redundantes", "Crear una lista de tareas - Identificar dependencias - Mostrar elementos de la capa de tarea y Eliminar dependencias redundantes"] },
        { q: "22. En el ciclo del prototipado efectivo...", a: 0, opts: ["Es la mezcla justa de conceptos y de prototipo experimental", "Es un proceso deductivo y no repetible, ya que depende de la pericia de los integrantes del grupo de desarrollo/dise침o.", "Se debe dar prioridad a la creencia del prototipado de alta fidelidad, ya que aporta un nivel de detalle muy pr칩ximo al producto real."] },
        { q: "23. Dentro de la verificaci칩n de requerimientos, decimos que...", a: 1, opts: ["Los requerimientos software y los del prototipado son los mismos, son procesos paralelos.", "Los requerimientos del prototipo no son los mismo que los requerimientos del software.", "Los requerimientos del prototipado nos muestran el estado final del prototipo"] },
        { q: "24. Las subfases de la fase de Resultados son:", a: 1, opts: ["Verificar requerimientos, determinar caracter칤sticas y validar el dise침o.", "Revisar el dise침o, validar el dise침o y desplegar el dise침o", "Seleccionar el criterio de dise침o, validar el dise침o y desplegar el dise침o."] },
        { q: "25. 쮻e qu칠 subfases consta la fase 2 de Especificaci칩n?", a: 0, opts: ["Determinar caracter칤sticas, elegir el m칠todo y elegir la herramienta", "Determinar caracter칤sticas, elegir el m칠todo y definir el contenido/fidelidad", "Todas las anteriores respuestas son correctas."] },
        { q: "26. Las subfases en las que se divide la fase 1 del ciclo efectivo son:", a: 0, opts: ["Verificar requerimientos, desarrollo del flujo de tareas y definir el contenido y la fidelidad.", "Verificar requerimientos, desarrollo del flujo de tareas y crear el dise침o", "Determinaci칩n de caracter칤sticas, desarrollo del flujo de tareas y definir el contenido y la fidelidad."] },
        { q: "27. Las caracter칤sticas a determinar en la fase de especificaci칩n son:", a: 1, opts: ["Audiencia, estado, velocidad, Longevidad, Unidad y variedad. Estilo. Medio, Flujo de informaci칩n", "Audiencia, estado, velocidad, Longevidad, Expresi칩n, Estilo, Medio, Fidelidad", "Estructura tipogr치fica, estado, velocidad, Ritmo y patr칩n, Expresi칩n, Estilo, Medio, Fidelidad"] },
        { q: "28. Dentro de las gu칤as visuales de dise침o...", a: 2, opts: ["En la organizaci칩n basada en tablas nos garantizamos que el branding de la marca es respetado por la interfaz.", "Todas las respuestas anteriores son correctas.", "El flujo de informaci칩n sirve para de ayuda para decidir d칩nde colocar los elementos en el dise침o de la disposici칩n de una interfaz"] },
        { q: "29. En la fase de Especificaci칩n, decimos que...", a: 2, opts: ["Se determina el qu칠 dentro del ciclo de prototipado efectivo.", "Se determina el cu치ndo dentro del ciclo de prototipado efectivo.", "Se determina el c칩mo dentro del ciclo de prototipado efectivo."] },
        { q: "30. En la revisi칩n del dise침o, dentro de la fase de resultados del prototipado, podemos afirmar que:", a: 0, opts: ["Es una revisi칩n interna, ya que ir치 enfocada al juicio de los miembros del equipo de desarrollo/dise침o, altos directivos y analistas de mercado", "Es una revisi칩n interna, ya que ir치 enfocada al juicio de los clientes y usuarios finales", "Es una revisi칩n externa, ya que ir치 enfocada al juicio de los clientes y usuarios finales"] },
        { q: "31. En la creaci칩n del prototipo, el ciclo de dise침o y construcci칩n consta de las siguientes fases:", a: 1, opts: ["1 Determinar las pantallas de mayor prioridad, 2 Bloquear las regiones m치s importantes, 3 Layout de la pantalla con m치s alta prioridad,4 Especificar la l칩gica de dise침o y 5 Disposici칩n de pantallas prioritarias restantes.", "1 Determinar las pantallas de mayor prioridad, 2 Bloquear las regiones m치s importantes, 3 Layout de la pantalla con m치s alta prioridad.4 Disposici칩n de pantallas prioritarias restantes y 5 Especificar la l칩gica de dise침o.", "1 Determinar las pantallas de mayor prioridad, 2 Bloquear las regiones m치s importantes, 3 Disposici칩n de pantallas prioritarias restantes, 4 Especificar la l칩gica de dise침o y 5 Layout de la pantalla con m치s alta prioridad."] },
        { q: "32. 쯈ue fases comprende dentro de la revisi칩n interna del dise침o en el ciclo de prototipado?", a: 1, opts: ["1. Definir el p칰blico objetivo, 2 C칩mo se presentar치 y 3 Especificar la l칩gica de dise침o, 4 Elegir el m칠todo y 5 Elegir la herramienta", "1. Definir el p칰blico objetivo, 2 Conjunto de objetivos para cada versi칩n, 3 Conjunto de expectativas de los revisores, 4 C칩mo se presentar치 y 5 Especificar la l칩gica de dise침o", "1. Definir el p칰blico objetivo, 2 Conjunto de objetivos para cada versi칩n, 3 C칩mo se presentar치 y 4 Especificar la l칩gica de dise침o"] },
        { q: "33. 쯈u칠 acciones se deben seguir cuando el prototipo est칠 terminado?", a: 1, opts: ["Normalmente el cliente se compromete a no realizar actualizaciones, y el equipo se encuentra exonerado de cualquier actualizaci칩n posterior", "Tendremos que tener en cuenta la opini칩n del dise침o, la validaci칩n de la usabilidad, la iteraci칩n en la que nos encontramos y el 치mbito de aplicaci칩n que tendr치 el prototipo.", "Todas las respuestas anteriores son incorrectas"] },
        { q: "34. 쯈u칠 directrices forman parte de la gu칤a de interfaz de usuario?", a: 0, opts: ["Revelaci칩n progresiva, Rendimiento, Ley de Fitt, Facilidad de aprendizaje, Hablar el lenguaje de la audiencia, mostrar expl칤citamente las acciones y campos necesarios, sensibilidad internacional, accesibilidad universal, minimizar la carga cognitiva, el control debe tenerlo el usuario y satisfacci칩n", "Revelaci칩n progresiva, Rendimiento, Ley de Fitt, Facilidad de aprendizaje, Hablar el lenguaje de la audiencia, longevidad, velocidad, accesibilidad universal, organizaci칩n basada en tablas, Flujo de informaci칩n y satisfacci칩n", "Tan s칩lo el flujo de informaci칩n y la Ley de Fitt determinan realmente las directrices que evitan problemas de usabilidad en la interfaz de usuario"] },
        { q: "35. Dentro de la fase de Planificaci칩n del prototipo", a: 1, opts: ["Todos los supuestos se transformar치n en requerimientos.", "No todos los supuestos podr치n ser transformados en requerimientos, muchos podr치n ser no validados.", "Los supuestos son requerimientos y podr치n ser utilizados dentro en el ciclo de Ingenier칤a del Software"] },
        { q: "36. La facilidad de aprendizaje...", a: 1, opts: ["Hace que el prototipo sea f치cil de aprender y que el usuario sea capaz de utilizar los conocimientos actuales y adquiridos por el uso de la aplicaci칩n.", "Es una directriz de las qu칤as visuales", "Nos proporciona informaci칩n del uso que realiza el usuario de la interfaz"] },
        { q: "37. En la elecci칩n de la herramienta de prototipado, es falso que...", a: 2, opts: ["Deberemos utilizar herramientas de prototipado complementarias.", "Trabajar con una sola herramienta no es eficiente", "No pasa nada si sobrecargamos el dise침o con demasiados detalles gracias a la herramienta elegida."] },
        { q: "38. Podemos decir que un storyboard tiene...", a: 1, opts: ["se representa de forma codificada y en 칠l se articulan las necesidades de comercializaci칩n de negocios y se representa en forma de un escenario o historia de uso.", "un estilo narrativo y se utiliza en las fases tempranas del proceso de dise침o", "Un estilo interactivo y se utiliza en las 칰ltimas fases del proceso de dise침o"] },
        { q: "39. Para validar los prototipos con los actores externos usaremos,", a: 1, opts: ["Pruebas de usabilidad, test de accesibilidad y aplicaremos teor칤a del color.", "Pruebas de Usabilidad, focus group y sesiones de evaluaci칩n", "Aplicaremos los 10 principios de usabilidad de Jakob Nielsen"] },
        { q: "40. Seg칰n la Ley de Fitt...", a: 2, opts: ["Nos proporciona precisamente en que tiempo se puede alcanzar un objeto dependiendo de su tama침o y opacidad.", "Nos proporciona precisamente en que tiempo se puede alcanzar un objeto dependiendo de su tama침o y color.", "Nos proporciona precisamente en que tiempo se puede alcanzar un objeto dependiendo de su tama침o y lejan칤a."] },
        { q: "41. En el dise침o쮺u치les son fases en la creaci칩n del prototipo?", a: 2, opts: ["Determinar las pantallas de mayor prioridad, bloquear las regiones m치s importantes, disposici칩n de pantallas prioritarias restantes y testing", "Determinar las pantallas de mayor prioridad, bloquear las regiones m치s importantes, implementaci칩n, especificar la l칩gica de dise침o y testing", "Determinar las pantallas de mayor prioridad, bloquear las regiones m치s importantes, disposici칩n de pantallas prioritarias restantes y layout de la pantalla con m치s alta prioridad"] },
        { q: "42. 쮺uales son m칠todos de especificaci칩n de un prototipo?", a: 1, opts: ["Card Sorting, wireframe, storyboard y recorrido cognitivo", "Card Sorting, wireframe, storyboard y modelo blanco", "Card Sorting, heuristicas, storyboard y Mago de Oz"] },
        { q: "43. Alguno de los m칠todos de evaluaci칩n que podemos encontrar para evaluar el dise침o:", a: 1, opts: ["Con modelos en blanco, pruebas de usabilidad, revisi칩n heur칤stica, revisiones externas y encuestas de satisfacci칩n", "Pruebas de usabilidad, revisiones externas, focus group, revisiones de pares, recorridos cognitivos, encuestas de satisfacci칩n.", "Pruebas de usabilidad, eyetracking, focus group, test A/B, revisiones de pares y recorridos cognitivos."] },
        { q: "44. Antes de crear un prototipo de manera eficaz, la primera actividad es:", a: 0, opts: ["Revisar el equilibrio entre las suposiciones y los requisitos, incluyendo los de negocios/marketing, funcionales, t칠cnicos y de usabilidad.", "Seleccionar inmediatamente la herramienta de software m치s avanzada para garantizar una alta fidelidad desde el principio.", "Comenzar la codificaci칩n del sistema para tener una base s칩lida sobre la que dise침ar la interfaz visual."] },
        { q: "45. Dentro de las estrategias de distribuci칩n del prototipo, nos encontramos con:", a: 1, opts: ["Narrativo, interactivo, storyboard.", "Narrativo, interactivo, abierto y cerrado.", "Focus Group, interactivo, narrativo y abierto."] },
        { q: "46. Podemos definir un diagrama de carril como:", a: 2, opts: ["La representaci칩n visual de una serie de tareas o los pasos de una tarea sin asignar roles espec칤ficos.", "La narraci칩n de un flujo de tareas en un contexto espec칤fico, como un incidente cr칤tico o una historia cotidiana.", "Todas las respuestas anteriores son incorrectas."] },
        { q: "47. 쮺u치les son las principales consideraciones del dise침o visual?:", a: 0, opts: ["Layout, tipograf칤a, elementos gr치ficos, selecci칩n de fuentes, esquema de color y branding.", "La arquitectura de la base de datos, el lenguaje de programaci칩n backend y los protocolos de seguridad.", "La identificaci칩n de los roles de usuario, los puntos de interacci칩n y los medios de colaboraci칩n en el flujo de trabajo."] },
        { q: "48. 쯈u칠 es un modelo en blanco?", a: 2, opts: ["Un m칠todo que permite a un equipo realizar una prueba experimental simulando las respuestas del sistema (Mago de Oz).", "Un prototipo interactivo creado con lenguaje de programaci칩n o scripting como Java.", "Todas las respuestas anteriores son incorrectas."] },
        { q: "49. La directriz ritmo y patron", a: 1, opts: ["Guia al usuario hacia donde debe poner el foco de la informacion importante.", "El primero marca la periodicidad o flujo de los elementos y el segundo la repetici칩n que implica la duplicaci칩n de un m칩dulo espaciado.", "Nos ayuda en marcar la periodicidad o flujo de los elementos y en la consistencia de un m칩dulo espec칤fico."] },
        { q: "50. El balance es una directriz que...", a: 0, opts: ["Aporta equilibrio entre contraste, opuesto, o intercacci칩n entre elementos.", "Aporta equilibrio entre elementos esteticamente discordantes y con balance asimetrico.", "Ayuda a mejorar el balance de los elementos en la disposicion de grid."] },
        { q: "51. Dentro de balance podemos encontrar con...", a: 0, opts: ["Dise침os sim칠tricos con un eje central que organiza los elementos de la interfaz, con desigual importancia, a los dos lados de la pantalla.", "Dise침os asim칠tricos que pueden ser v치lidos si el que menor peso visual tiene aporta mayor informaci칩n al usuario", "Se encarga de controlar el flujo de la informaci칩n a los dos lados de la pantalla si traz치ramos un eje imaginario"] },
        { q: "52. 쯈u칠 es la revelaci칩n progresiva?", a: 0, opts: ["Es una t칠cnica para prevenir de la sobreexposici칩n al usuario de la informaci칩n.", "T칠cnica que se encarga de revelar una estructura no visible para minimizar el scroll vertical", "En presentaci칩n simples es una t칠cnica com칰nmente utilizada."] },
        { q: "53. 쯈u칠 fases son importantes en el despliegue del dise침o?", a: 1, opts: ["Establecer expectativas para transferencia y documentar los resultados del prototipo", "Establecer expectativas para transferencia, estrategias de distribuci칩n del prototipo y documentar los resultados del prototipo", "Dise침ar el flujo de la presentaci칩n, estrategias de distribuci칩n del prototipo y documentar los resultados del prototipo"] },
        { q: "54. 쯈u칠 proporciona una prueba de concepto?", a: 1, opts: ["Al poder probar de forma interna el prototipo, antes de la producci칩n, el riesgo aumenta para el usuario externo", "Al poder probar de forma interna y externa el prototipo, antes de la producci칩n, el riesgo se reduce", "Ninguna es correcta"] }
    ];

    // Asignar 칤ndice original para rastrear fallos
    const pdfData = rawPdfData.map((item, index) => ({ ...item, originalIndex: index }));

    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let quizMode = '';
    
    // Para guardar las respuestas de la sesi칩n actual
    // Formato: { originalIndex, questionText, selectedOptText, correctOptText, isCorrect }
    let sessionResults = [];

    // --- VARIABLES DE ESTADO Y PERSISTENCIA ---
    let failedQuestionsSet = new Set(); // 칈ndices originales de preguntas falladas
    let examHistory = []; // Historial de ex치menes

    // Elementos DOM
    const configScreen = document.getElementById('config-screen');
    const quizScreen = document.getElementById('quiz-screen');
    const resultScreen = document.getElementById('result-screen');
    const statsScreen = document.getElementById('stats-screen');
    const reviewScreen = document.getElementById('review-screen');
    
    const questionContainer = document.getElementById('question-container');
    const nextBtn = document.getElementById('next-btn');
    const feedbackDiv = document.getElementById('feedback');
    const progressText = document.getElementById('progress-text');
    const scoreText = document.getElementById('score-text');
    
    const btnFailedMode = document.getElementById('btn-failed-mode');
    const failedCountBadge = document.getElementById('failed-count-badge');

    // Inicializaci칩n
    window.onload = function() {
        loadDataFromStorage();
        updateMenuUI();
    };

    // --- L칍GICA DE STORAGE ---
    function loadDataFromStorage() {
        const storedFailed = localStorage.getItem('dsi_failed_questions');
        if (storedFailed) {
            failedQuestionsSet = new Set(JSON.parse(storedFailed));
        }

        const storedHistory = localStorage.getItem('dsi_quiz_history');
        if (storedHistory) {
            examHistory = JSON.parse(storedHistory);
        }
    }

    function saveDataToStorage() {
        localStorage.setItem('dsi_failed_questions', JSON.stringify([...failedQuestionsSet]));
        localStorage.setItem('dsi_quiz_history', JSON.stringify(examHistory));
        updateMenuUI();
    }

    function updateMenuUI() {
        failedCountBadge.textContent = failedQuestionsSet.size;
        
        if (failedQuestionsSet.size === 0) {
            btnFailedMode.classList.add('disabled');
            btnFailedMode.onclick = null;
        } else {
            btnFailedMode.classList.remove('disabled');
            btnFailedMode.onclick = () => startQuiz('review_failed');
        }
    }

    // --- L칍GICA DEL QUIZ ---

    function startQuiz(mode) {
        quizMode = mode;
        let questionsToLoad = [];

        // Estrategia de carga seg칰n modo
        if (mode === 'ordered') {
            // Copia profunda
            questionsToLoad = JSON.parse(JSON.stringify(pdfData));
        } 
        else if (mode === 'shuffle_q') {
            questionsToLoad = JSON.parse(JSON.stringify(pdfData));
            questionsToLoad.sort(() => Math.random() - 0.5);
        } 
        else if (mode === 'shuffle_all') {
            questionsToLoad = JSON.parse(JSON.stringify(pdfData));
            questionsToLoad.sort(() => Math.random() - 0.5);
            // Mezclar respuestas
            questionsToLoad.forEach(shuffleAnswers);
        }
        else if (mode === 'review_failed') {
            // Solo cargar las preguntas cuyos 칤ndices est칠n en el Set de fallos
            questionsToLoad = pdfData.filter(q => failedQuestionsSet.has(q.originalIndex));
            // Copia profunda para no mutar el original
            questionsToLoad = JSON.parse(JSON.stringify(questionsToLoad));
            
            if (questionsToLoad.length === 0) {
                alert("춰Felicidades! No tienes fallos pendientes.");
                return;
            }
            questionsToLoad.sort(() => Math.random() - 0.5);
        }

        currentQuestions = questionsToLoad;
        currentQuestionIndex = 0;
        score = 0;
        sessionResults = [];

        configScreen.style.display = 'none';
        statsScreen.style.display = 'none';
        quizScreen.style.display = 'block';
        resultScreen.style.display = 'none';

        loadQuestion();
    }

    function shuffleAnswers(q) {
        // Crear array temporal para mantener rastro de la correcta
        let optionsWithIndex = q.opts.map((optText, index) => ({
            text: optText,
            isCorrect: index === q.a
        }));

        optionsWithIndex.sort(() => Math.random() - 0.5);

        q.opts = optionsWithIndex.map(o => o.text);
        q.a = optionsWithIndex.findIndex(o => o.isCorrect);
    }

    function loadQuestion() {
        const qData = currentQuestions[currentQuestionIndex];
        
        progressText.textContent = `Pregunta ${currentQuestionIndex + 1} de ${currentQuestions.length}`;
        scoreText.textContent = `Aciertos: ${score}`;

        feedbackDiv.style.display = 'none';
        nextBtn.disabled = true;

        let html = `<div class="question-text">${qData.q}</div><div class="options">`;
        qData.opts.forEach((opt, index) => {
            const letter = String.fromCharCode(97 + index); // a, b, c
            html += `<button class="option-btn" onclick="checkAnswer(${index}, this)">${letter}) ${opt}</button>`;
        });
        html += `</div>`;
        questionContainer.innerHTML = html;
    }

    window.checkAnswer = function(selectedIndex, btnElement) {
        const qData = currentQuestions[currentQuestionIndex];
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(btn => btn.disabled = true);

        const isCorrect = (selectedIndex === qData.a);
        
        // Guardar resultado de la sesi칩n
        sessionResults.push({
            originalIndex: qData.originalIndex,
            questionText: qData.q,
            selectedOptText: qData.opts[selectedIndex],
            correctOptText: qData.opts[qData.a],
            isCorrect: isCorrect
        });

        if (isCorrect) {
            btnElement.classList.add('correct');
            score++;
            scoreText.textContent = `Aciertos: ${score}`;
            feedbackDiv.innerHTML = `<strong>춰Correcto!</strong>`;
            feedbackDiv.style.borderColor = 'var(--success)';
            feedbackDiv.style.backgroundColor = '#dcfce7';
        } else {
            btnElement.classList.add('incorrect');
            allBtns[qData.a].classList.add('correct');
            const correctLetter = String.fromCharCode(97 + qData.a);
            feedbackDiv.innerHTML = `<strong>Incorrecto.</strong> La correcta era: <strong>${correctLetter})</strong>`;
            feedbackDiv.style.borderColor = 'var(--error)';
            feedbackDiv.style.backgroundColor = '#fee2e2';
        }

        feedbackDiv.style.display = 'block';
        nextBtn.disabled = false;
    }

    window.nextQuestion = function() {
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuestions.length) {
            loadQuestion();
        } else {
            finalizeExam();
        }
    }

    window.confirmExit = function() {
        if(confirm("쯉eguro que quieres salir? Se perder치 el progreso de este examen.")) {
            goToMenu();
        }
    }

    function finalizeExam() {
        // 1. Calcular Nota
        const percentage = Math.round((score / currentQuestions.length) * 100);
        
        // 2. Actualizar Historial
        const newRecord = {
            id: Date.now(),
            date: new Date().toLocaleString(),
            mode: getModeName(quizMode),
            score: score,
            total: currentQuestions.length,
            percentage: percentage,
            details: sessionResults // Guardamos detalle completo
        };
        examHistory.unshift(newRecord); // A침adir al principio

        // 3. Actualizar Fallos (L칩gica)
        sessionResults.forEach(res => {
            if (res.isCorrect) {
                // Si acierta, borramos de la lista de fallos (si estaba)
                failedQuestionsSet.delete(res.originalIndex);
            } else {
                // Si falla, a침adimos a la lista de fallos
                failedQuestionsSet.add(res.originalIndex);
            }
        });

        // 4. Guardar en Storage
        saveDataToStorage();

        // 5. Mostrar Resultados
        showResults(percentage);
    }

    function getModeName(mode) {
        if (mode === 'ordered') return 'Est치ndar';
        if (mode === 'shuffle_q') return 'Aleatorio';
        if (mode === 'shuffle_all') return 'Dif칤cil';
        if (mode === 'review_failed') return 'Repaso Fallos';
        return mode;
    }

    function showResults(percentage) {
        quizScreen.style.display = 'none';
        resultScreen.style.display = 'block';
        
        document.getElementById('final-score').textContent = `${percentage}%`;
        
        let msg = "";
        if (percentage >= 90) msg = "춰Excelente! Has dominado el documento.";
        else if (percentage >= 70) msg = "춰Buen trabajo! Vas bien preparado.";
        else if (percentage >= 50) msg = "Aprobado justo. Conviene repasar.";
        else msg = "Necesitas repasar m치s. 춰츼nimo!";
        
        document.getElementById('final-msg').textContent = msg;
    }

    // --- PANTALLAS DE ESTAD칈STICAS ---

    window.showStatsScreen = function() {
        configScreen.style.display = 'none';
        resultScreen.style.display = 'none';
        reviewScreen.style.display = 'none';
        statsScreen.style.display = 'block';

        const container = document.getElementById('history-container');
        container.innerHTML = '';

        if (examHistory.length === 0) {
            container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No hay ex치menes registrados a칰n.</p>';
            return;
        }

        examHistory.forEach(exam => {
            const div = document.createElement('div');
            div.className = 'history-item';
            div.onclick = () => showReviewDetails(exam);
            
            let scoreClass = 'score-mid';
            if (exam.percentage >= 70) scoreClass = 'score-good';
            if (exam.percentage < 50) scoreClass = 'score-bad';

            div.innerHTML = `
                <div>
                    <strong>${exam.date}</strong><br>
                    <span style="font-size: 0.9rem; color: #666;">${exam.mode} (${exam.total} preguntas)</span>
                </div>
                <div class="history-score ${scoreClass}">
                    ${exam.score}/${exam.total} (${exam.percentage}%)
                </div>
            `;
            container.appendChild(div);
        });
    }

    window.showReviewDetails = function(exam) {
        statsScreen.style.display = 'none';
        reviewScreen.style.display = 'block';

        const meta = document.getElementById('review-meta');
        meta.textContent = `${exam.date} - ${exam.mode} - Nota: ${exam.percentage}%`;

        const container = document.getElementById('review-container');
        container.innerHTML = '';

        exam.details.forEach((det, idx) => {
            const card = document.createElement('div');
            card.className = `review-card ${det.isCorrect ? 'is-correct' : 'is-incorrect'}`;
            
            card.innerHTML = `
                <div class="review-q">
                    ${idx + 1}. ${det.questionText}
                    ${det.isCorrect 
                        ? '<span class="badge" style="background:#dcfce7; color:#166534">CORRECTA</span>' 
                        : '<span class="badge" style="background:#fee2e2; color:#991b1b">INCORRECTA</span>'}
                </div>
                <div class="review-ans">
                    <strong>Tu respuesta:</strong> ${det.selectedOptText}
                </div>
                ${!det.isCorrect ? `
                <div class="review-ans" style="color: #166534; margin-top:5px;">
                    <strong>Respuesta correcta:</strong> ${det.correctOptText}
                </div>` : ''}
            `;
            container.appendChild(card);
        });
    }

    window.goToMenu = function() {
        quizScreen.style.display = 'none';
        resultScreen.style.display = 'none';
        statsScreen.style.display = 'none';
        reviewScreen.style.display = 'none';
        configScreen.style.display = 'block';
        updateMenuUI();
    }
</script>

</body>
</html>
